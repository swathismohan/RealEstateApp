<header>
  <h1>
    <i *ngIf = "apicustomer.firstName">Welcome {{ apicustomer.firstName }},</i>
    <button mat-raised-button class="legal" (click)="onCompletion()">Logout</button>
    <button *ngIf = "!customer.legalSubscription" mat-raised-button class="legal" (click)="openDialog()">Get Legal Subscription</button>
  </h1>
</header>

<mat-tab-group mat-align-tabs="start" (selectedTabChange)="getPropertyByCustomerId($event)">
  <mat-tab label="My profile">
    <mat-card class="profile-card-container">
      <mat-card-header class="card-header">
        <mat-card-title>My Profile</mat-card-title>
        <button mat-icon-button aria-label="edit button" style="margin-left: auto;" (click)="editCustomerProfile()">
          <mat-icon>create</mat-icon>
        </button>
      </mat-card-header>
      <mat-card-content class="card-contents">
        <div class="contents">
          <h4>Name:</h4>
          <h4>Id Number:</h4>
          <h4>Address:</h4>
          <h4>E-mail:</h4>
          <h4>Phone number:</h4>
        </div>
        <div class="contents">
          <p>{{apicustomer.firstName}} {{apicustomer.lastName}}</p>
          <p>{{apicustomer.identification.id}}</p>
          <p>{{apicustomer.addresses[0].line1}}, {{apicustomer.addresses[0].line2}}</p>
          <p>{{apicustomer.emailAddresses[0].address}}</p>
          <p>{{apicustomer.phoneNumbers[0].number}}</p>
        </div>
      </mat-card-content>
    </mat-card>
  </mat-tab>
  <mat-tab label="Add property">
    <mat-card class="card-container">
      <mat-card-header class="card-header">
        <mat-card-title class="bottom-margin">Property Details</mat-card-title>
      </mat-card-header>
      <form class="full-width form-container">
        <mat-form-field class="field">
          <input type="text" matInput placeholder="Property Name" [(ngModel)] = "propertyName" name= "propertyName"/>
        </mat-form-field>
        <mat-form-field class="field">
          <input type="text" matInput placeholder="Property Number" [(ngModel)] = "propertyNumber" name= "propertyNumber" required/>
        </mat-form-field>
        <mat-form-field class="field">
          <input type="text" matInput placeholder="Address Line 1" [(ngModel)] = "addline1" name= "addline1"/>
        </mat-form-field>
        <mat-form-field class="field">
          <input type="text" matInput placeholder="Address Line 2" [(ngModel)] = "addline2" name= "addline2"/>
        </mat-form-field>
        <mat-form-field class="field">
          <input type="text" matInput placeholder="Address Line 3" [(ngModel)] = "addline3" name= "addline3"/>
        </mat-form-field>
        <mat-form-field class="field">
          <input type="number" matInput placeholder="Postal Code" [(ngModel)] = "postalCode" name= "postalCode" required/>
        </mat-form-field>
      <mat-form-field class="field">
        <input type="number" matInput placeholder="Market Value" [(ngModel)] = "marketValue" name= "marketValue" required/>
      </mat-form-field>
      <mat-form-field class="field">
        <mat-label>Ownership</mat-label>
        <mat-select [(ngModel)] = "ownership" name="ownership" required>
          <mat-option *ngFor="let o of ownershiptype" [value]= "o">
            {{o}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="field">
        <mat-label>Green Belt</mat-label>
      <mat-select [(ngModel)]="greenBelt" name="greenBelt" required>
        <mat-option value="YES">YES</mat-option>
        <mat-option value="NO">NO</mat-option>
      </mat-select>
      </mat-form-field>
      <mat-form-field class="field">
        <mat-label>Property Type</mat-label>
        <mat-select [(ngModel)] = "propertyType" name="propertyType" required>
          <mat-option *ngFor="let t of type" [value]= "t">
            {{t}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="field">
        <input type="text" matInput placeholder="Area" [(ngModel)] = "area" name= "area" required/>
      </mat-form-field>
      <mat-form-field class="field">
        <mat-label>Area Unit</mat-label>
        <mat-select [(ngModel)] = "areaUnit" name="areaUnit" required>
          <mat-option *ngFor="let a of areaunits" [value]= "a">
            {{a}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="field">
        <mat-label>Additional Details(Upload if any files)</mat-label>
        <textarea matInput [(ngModel)] = "notes" name= "notes"></textarea>
      </mat-form-field>
        <input type="file" class="field" onchange="console.log(event.target.files)">
      <br>
      <button mat-raised-button [disabled]="propertyAdded" color="primary" class="left-margin" (click)="addProperty()" type="submit">Add Property <mat-icon *ngIf="propertyAdded">check_box</mat-icon></button>
      </form>
    </mat-card>
  </mat-tab>

  <mat-tab label="Property details">
    <br />
    <div *ngIf=properties.length>
    <mat-expansion-panel class="panel" *ngFor="let prop of properties">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <b>{{ prop.propertyName }}</b>
        </mat-panel-title>

        <mat-panel-description>
          {{prop.verification}}
        </mat-panel-description>

        <button mat-icon-button aria-label="edit button" style="margin-right: 1cm;" (click)="gotoEditProperty(prop.propertyId)">
          Edit
          <mat-icon>create</mat-icon>
        </button>

      </mat-expansion-panel-header>

      <mat-card>
      <mat-card-content class="card-contents">
        <div class="property-contents">
          <h4>Address:</h4>
          <h4>Postal code:</h4>
          <h4>Market value:</h4>
          <h4>GreenBelt:</h4>
          <h4 *ngIf="prop.verification === 'VERIFIED' || prop.verification === 'REJECTED'">Verification comment:</h4>
        </div>
        <div class="property-contents">
          <p>{{prop.addline1}}</p>
          <p>{{prop.postalCode}}</p>
          <p>{{prop.marketValue}}</p>
          <p>{{prop.greenBelt}}</p>
          <p *ngIf="prop.verification === 'VERIFIED' || prop.verification === 'REJECTED'">{{prop.comment}}</p>
        </div>
      </mat-card-content>
      <mat-card-actions>
      <button
      mat-raised-button
      (click)="gotoPropertyBids(prop.propertyId)"
      class="top-margin left-margin"
      color="primary">
      View bids
    </button>
    <button
      mat-raised-button
      (click)="requestVerification(prop.propertyId,'VERIFICATION REQUESTED')"
      class="top-margin left-margin"
      color="primary"
      *ngIf="prop.verification === 'PENDING VERIFICATION'">
      Request Verification
    </button>
    <button
    mat-raised-button
    (click)="updateProperty(prop.propertyId,'NOT AVAILABLE')"
    class="top-margin left-margin"
    color="primary"
    *ngIf="prop.status === 'AVAILABLE'">
    Make it Unavailable
    </button>
    <button
    mat-raised-button
    (click)="updateProperty(prop.propertyId,'AVAILABLE')"
    class="top-margin left-margin"
    color="primary"
    *ngIf="prop.status === 'NOT AVAILABLE'">
    Make it Available
    </button>

  </mat-card-actions>
    </mat-card>
    </mat-expansion-panel>
  </div>
    <h3 *ngElse>No properties added</h3>
  </mat-tab>

  <mat-tab *ngIf = "customer.legalSubscription" label="Legal Advisory">
    <div class="legalContainer">
    <form>
      <mat-form-field appearance="outline" class="quesArea">
        <mat-label>Post a question</mat-label>
        <textarea matInput rows="8" [(ngModel)] = "question" name= "question"></textarea>
      </mat-form-field>
      &nbsp;
      <br>
      <button mat-raised-button class="btn btn btn-success" (click)="postQuestion()" type="submit" color="primary">Post Question</button>
     </form>

     <div *ngIf=questions.length class="panel">
      <mat-expansion-panel class="panel" *ngFor="let ques of questions">
        <mat-expansion-panel-header>
            <b>{{ ques.question }}</b>
        </mat-expansion-panel-header>

        <mat-card>
        <mat-card-content class="card-contents">
          {{ques.answer}}
        </mat-card-content>
      </mat-card>
      </mat-expansion-panel>
    </div>
  </div>
  </mat-tab>

</mat-tab-group>
